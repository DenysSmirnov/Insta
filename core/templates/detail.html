{% extends 'base.html' %}
{% block main %}
<section class="_sq4bv _29u45">
<main class="_main">
  <div>
    <div class="_owark">
  {% for img in images %}
  <article class="_s5vjd _622au _5lms4 _8n9ix" >
        <header class="_art_head">
        <a class="_4a6q9 _i2o1o _gvoze" href="{{ url_for('.user', username=img.author.name) }}" style="width: 30px;height: 30px;">
        <img class="_rewi8" src="{{ resize_url + img.author.avatar }}"></a>
          <div>
          <a class="_art_head_2" href="{{ url_for('.user', username=img.author.name) }}">{{ img.author.name }}</a>
          <div>{{ img.title }}</div>
          </div>
          <div class="_del_post">
            <div class="_com _form_del">
              <form method="POST">
              {% if session['username'] == img.author.name %}
                <button class="_cl_but_del" name="post_del" type="submit" value="{{ img._id }}" title="Удалить публикацию"><img src="/static/ico/_dcom.png"></button>
                <input type="hidden" name="id" value="{{ img._id }}">
              {% endif %}
              </form>
            </div>
          </div>
        </header>
      <div><img src="{{ resize_url + img.path }}" width="600px"></div>
      <!-- <div><img src="{{ url_for('static', filename='upload/resized-images/'+ img.path) }}" width="600px"></div> -->
  <div class="_art_foot">
    <form class="_8oo9w" method="POST">
    {% if session['username'] in img.liked_users %}
      <button class="_cl_but" name="like" type="submit" value="{{ img._id }}"><img src="/static/ico/heart_red.png"></button>
    {% else %}
      <button class="_cl_but" name="like" type="submit" value="{{ img._id }}"><img src="/static/ico/heart_white.png"></button>
    {% endif %}
    {% if img.liked_users %}
      Нравится: {{ img.liked_users | length }}
    {% endif %}
    </form>
    <div class="_com _aut_com">
    {% if img.description %}
      <span><a class="_art_head_2" href="{{ url_for('.user', username=img.author.name) }}">{{ img.author.name }}</a> {{ img.description }}
    {% endif %}
          {% for tag in img.tags %}
            <span><a href="{{ url_for('.explore', tag=tag) }}">{{ tag }}</a></span>
          {% endfor %}
      </span>
    </div>
    <div>
      <div class="_listcoms">
      {% for com_dict in img.comments %}
        {% for username, comment in com_dict.items() %}
        <div class="_hdiv _com _aut_com"><a class="_art_head_2" href="{{ url_for('.user', username=username) }}">{{ username }}</a>
        <span>{{ comment }}</span>

        <!-- {% if comment | length > 160 %}
          {{ comment | truncate(160, False) }} <a href="{{ comment }}">еще</a>
        {% else %}
          {{ comment }}
        {% endif %} -->

          <div class="_com _form_del">
            <form method="POST">
            {% if session['username'] == img.author.name or session['username'] ==  username %}
              <button class="_cl_but_del" name="com_del" type="submit" value="{{comment}}" title="Удалить комментарий"><img src="/static/ico/_dcom.png"></button>
              <input type="hidden" name="id" value="{{ img._id }}">
            {% endif %}
            </form>
          </div>
        </div>
        {% endfor %}
      {% endfor %}
      {% if img.comments | length > 2 %}
        <a class="archive" href="#"></a>
      {% endif %}
      </div>
  </div>
  <div class="_ha6c6 _6d44r">
  <time class="_p29ma _6g6t5" title="{{img.created_time | datetime}}"> 
  {{moment(img.created_time).fromNow(refresh = True)}}</time></div>

<section class="_km7ip _ti7l3">
  <form class="_b6i0l" method="POST">
    <textarea class="_bilrf" name="comment" placeholder="Добавьте комментарий..."></textarea>
    <input type="submit" class="cl_bsend" value="Send">
    <input type="hidden" name="id" value="{{ img._id }}">
  </form>
</section>
  </div>
  </article>
  {% endfor %}
    </div>
  </div>
</main>
</section>
{# <script src="/static/js/jq_coms.js"></script> #}
<script src="/static/js/res_ta.js"></script>
{% endblock %}